{% from "baseline/_components/_billing-row.njk" import billingRow %}
{% extends "layouts/" + version + ".html" %}

{% block beforeContent %}
  {% set showBackLink = true %}
  {% set showAccountLink = true %}
  {% set serviceName = "Dashboard" %}
  {% include version ~ "/_includes/before-content.njk" %}
{% endblock %}

{% block content %}



<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <span class="govuk-caption-l">Initial classified run R16</span>
    <h1 class="govuk-heading-l">Confirm billing instructions</h1>
    <p class="govuk-body-m">
      These billing instructions match those in the results file. 
      Use this screen to confirm
      which instructions you want to accept or reject.</p>

    <p class="govuk-body-m">
      Your changes are saved automatically, 
      so you can return to this screen at any time. 
      Once all instructions have been accepted or rejected, 
      you'll be able to generate a draft billing file. 
      If you reject any instructions, you'll need to give a reason on the next screen.
    </p>
          
    {% include "../_includes/billing-instructions-filter.njk" %}

    {# --- ROW 1: Selection Checkboxes --- #}
<div class="govuk-form-group govuk-!-margin-top-6">
  <fieldset class="govuk-fieldset">
    <div class="govuk-grid-row">
      
      {# Column 1: Select Page #}
      <div class="govuk-grid-column-one-half">
        <div class="govuk-checkboxes govuk-checkboxes--small horizontal-checkboxes">
          <div class="govuk-checkboxes__item">
            <input class="govuk-checkboxes__input" id="status-selectall" name="select-scope" type="checkbox" value="page">
            <label class="govuk-label govuk-checkboxes__label" for="status-selectall">
              Select all records on this page
            </label>
          </div>
        </div>
      </div>

      {# Column 2: Select All Dataset #}
      <div class="govuk-grid-column-one-half">
        <div class="govuk-checkboxes govuk-checkboxes--small horizontal-checkboxes">
          <div class="govuk-checkboxes__item">
            <input class="govuk-checkboxes__input" id="status-selectallresults" name="select-scope" type="checkbox" value="dataset">
            <label class="govuk-label govuk-checkboxes__label" for="status-selectallresults">
              Select all {{ totalRecords | default(0) }} records
            </label>
          </div>
        </div>
      </div>

    </div>
  </fieldset>
</div>

{# --- ROW 2: Counts & Pagination Info --- #}
<div class="govuk-grid-row govuk-!-margin-bottom-4">
  
  {# Column 1: Selected Count #}
  <div class="govuk-grid-column-one-half">
    <p class="govuk-body govuk-!-margin-bottom-4">
      <span id="selected-count">0</span> records selected
    </p>
  </div>

  {# Column 2: Pagination Range #}
  <div class="govuk-grid-column-one-half govuk-!-text-align-right">
    <p class="govuk-body govuk-!-margin-bottom-0">
      <strong>{{ displayStart }}-{{ displayEnd }} of {{ totalRecords }}</strong>
    </p>
  </div>

</div>
    
   <form action="/{{version}}/billing/confirm-update" method="post">
   <h2 class="govuk-heading-m">Billing instructions</h2>
      <table class="govuk-table billing-table">
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th class="govuk-table__header">&nbsp;</th>
            <th class="govuk-table__header billing-table__header--organisation">Organisation name</th>
            <th class="govuk-table__header billing-table__header--org-id">Organisation ID</th>
            <th class="govuk-table__header">Billing instruction</th>
            <th class="govuk-table__header">Invoice amount</th>
            <th class="govuk-table__header">Status</th>
          </tr>
        </thead>
       <tbody class="govuk-table__body">
        
        {# CHANGE 1: Loop through the sliced 'currentData' passed from the route #}
        {% for bill in currentData %}
          {{ billingRow(bill) }}
        {% endfor %}

      </tbody>
      </table>

      {# CHANGE 2: Pagination & Items Per Page Wrapper #}
      <div class="pagination-container govuk-!-margin-top-6" style="display: flex; justify-content: space-between; align-items: center;">
        
        {# A. Standard GDS Pagination #}
        <div class="pagination-left">
          {% from "govuk/components/pagination/macro.njk" import govukPagination %}
          {{ govukPagination(pagination) }}
        </div>

        {# B. Custom "Items per page" Selector #}
        <div class="items-per-page govuk-body" style="text-align: right;">
          <span class="govuk-!-margin-right-2">Items per page:</span>
          
          {# Helper macro to create the links #}
          {% macro limitLink(num) %}
            {% if limit == num %}
              <span class="govuk-!-font-weight-bold">{{ num }}</span>
            {% else %}
              {# Reset to page 1 when changing limit to avoid empty screens #}
              <a href="?page=1&limit={{ num }}" class="govuk-link govuk-link--no-visited-state">{{ num }}</a>
            {% endif %}
          {% endmacro %}

          {{ limitLink(10) }} 
          <span class="govuk-!-margin-left-1 govuk-!-margin-right-1">|</span>
          {{ limitLink(25) }}
          <span class="govuk-!-margin-left-1 govuk-!-margin-right-1">|</span>
          {{ limitLink(50) }}
        </div>
      </div>

      {# Update the "Showing X-Y" text at the top as well #}
      <div style="margin-top: 60px;">
        <h2 class="govuk-heading-m">Update billing instructions</h2>
        <div class="govuk-button-group">
          <button type="submit" class="govuk-button govuk-button--outline" data-module="govuk-button" name="update_action" value="accept">Accept selection</button>
          <button type="submit" class="govuk-button govuk-button--warning govuk-button--outline" data-module="govuk-button" name="update_action" value="reject">Reject selection</button>
          <button type="button" class="govuk-button govuk-button--secondary" id="clear-selection-btn">Clear selection</button>
          <a class="govuk-link" href="../paycal-dashboard">Return to dashboard</a>
        </div>
      </div>
    </form>
  </div>
</div>
{% endblock %}
